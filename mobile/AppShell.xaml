<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="mobile.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:auth="clr-namespace:mobile.Pages.Auth"
    xmlns:pages="clr-namespace:mobile.Pages"
    xmlns:controls="clr-namespace:mobile.Controls"
    Shell.FlyoutBehavior="Flyout">

    <!-- ðŸŽ¨ Menu Items - Modern Card Style -->
    <Shell.ItemTemplate>
        <DataTemplate>
            <controls:FlyoutMenuItem Title="{Binding Title}"
                                     Icon="{Binding FlyoutIcon}"
                                     IsSelected="{Binding IsChecked}" />
        </DataTemplate>
    </Shell.ItemTemplate>

    <!-- Header moderne -->
    <Shell.FlyoutHeader>
        <Grid HeightRequest="120" Padding="0" Background="{DynamicResource DarkBackground}">

            <Grid Padding="24,24,24,20" RowDefinitions="Auto,*,Auto">
                <!--<HorizontalStackLayout Grid.Row="0" Spacing="10">
                    <Label Text="â˜ï¸" 
                           FontSize="28" 
                           VerticalOptions="Center"/>
                    <Label Text="WeatherForecast" 
                           FontSize="17" 
                           FontAttributes="Bold"
                           TextColor="White"
                           Opacity="0.98"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>-->
                
                <HorizontalStackLayout Grid.Row="0" Spacing="12" VerticalOptions="Center">
                    <!--<Border StrokeShape="RoundRectangle 36"
                            BackgroundColor="White"
                            WidthRequest="72"
                            Padding="0"
                            Margin="0"
                            HeightRequest="72"
                            StrokeThickness="3"
                            Stroke="#FFFFFF">
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.3" Radius="16" Offset="0,4" />
                        </Border.Shadow>
                        <Label x:Name="UserInitialsLabel"
                               FontSize="25"
                               FontAttributes="Bold"
                               TextColor="#5B5FC7"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Opacity="0"
                               Scale="0.5"/>
                    </Border>-->
                    
                    <VerticalStackLayout VerticalOptions="Center" Spacing="6" MaximumWidthRequest="190">
                        <Label x:Name="UserFullNameLabel"
                               FontSize="19"
                               FontAttributes="Bold"
                               TextColor="White"
                               LineBreakMode="TailTruncation"
                               Opacity="0"
                               TranslationX="-30"/>
                        <Label x:Name="UserEmailLabel"
                               FontSize="14"
                               TextColor="White"
                               LineBreakMode="TailTruncation"
                               Opacity="0"
                               TranslationX="-30"/>
                    </VerticalStackLayout>
                </HorizontalStackLayout>
                

            </Grid>
        </Grid>
    </Shell.FlyoutHeader>

    <!-- Page principale (Dashboard) -->
    <ShellContent
        Title="Dashboard"
        Icon="{StaticResource IconDashboard}"
        ContentTemplate="{DataTemplate pages:MainPage}"
        Route="main" />

    <!-- Page des prÃ©visions mÃ©tÃ©o -->
    <ShellContent
        Title="PrÃ©visions"
        Icon="{StaticResource IconDashboard}"
        ContentTemplate="{DataTemplate pages:ForecastsPage}"
        Route="forecasts" />

    <!-- Page de profil (jamais visible dans le menu - accessible via TitleBar) -->
    <ShellContent
        x:Name="ProfileItem"
        Title="Profil"
        Icon="{StaticResource IconProfile}"
        ContentTemplate="{DataTemplate pages:ProfilePage}"
        Route="profile"
        FlyoutItemIsVisible="False" />

    <!-- Page de dÃ©marrage (Splash) - jamais visible dans le menu -->
    <ShellContent
        x:Name="SplashItem"
        Title="Chargement"
        ContentTemplate="{DataTemplate pages:SplashPage}"
        Route="splash"
        FlyoutItemIsVisible="False" />

    <!-- Page de connexion (jamais visible dans le menu) -->
    <ShellContent
        x:Name="LoginItem"
        Title="Connexion"
        Icon="{StaticResource IconDashboard}"
        ContentTemplate="{DataTemplate auth:LoginPage}"
        Route="login"
        FlyoutItemIsVisible="False" />

    <!-- Page d'inscription (jamais visible dans le menu) -->
    <ShellContent
        x:Name="RegisterItem"
        Title="Inscription"
        Icon="{StaticResource IconDashboard}"
        ContentTemplate="{DataTemplate auth:RegisterPage}"
        Route="register"
        FlyoutItemIsVisible="False" />

    <!-- Footer moderne -->
    <Shell.FlyoutFooter>
        <Grid Padding="0,0,0,10" RowDefinitions="Auto,Auto,Auto" RowSpacing="12">
            <BoxView Grid.Row="0" 
                     HeightRequest="1" 
                     BackgroundColor="{DynamicResource SeparatorColor}" 
                     Opacity="0.6"
                     Margin="0,0,0,8"/>
            
            <!-- Theme toggle row: switch centered with icons -->
            <Grid Grid.Row="1"
                  ColumnDefinitions="*,*,*"
                  WidthRequest="150"
                  HorizontalOptions="Center"
                  VerticalOptions="Center">
                <!-- IcÃ´ne Soleil alignÃ©e Ã  droite de sa colonne -->
                <Image Grid.Column="0"
                       WidthRequest="24"
                       HeightRequest="24"
                       HorizontalOptions="Center"
                       VerticalOptions="Center">
                    <Image.Source>
                        <FontImageSource FontFamily="SegoeMDL2"
                                         Glyph="&#xE706;"
                                         Size="22"
                                         Color="{DynamicResource SecondaryTextColor}"/>
                    </Image.Source>
                </Image>

                <!-- Switch au centre -->
                <Switch Grid.Column="1"
                        x:Name="ThemeSwitch"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        OnColor="{DynamicResource PrimaryGradientStartColor}"
                        ThumbColor="{DynamicResource LightSecondaryBackground}"
                        Toggled="ThemeSwitch_Toggled" />

                <!-- IcÃ´ne Lune alignÃ©e Ã  gauche de sa colonne -->
                <Image Grid.Column="2"
                       WidthRequest="24"
                       HeightRequest="24"
                       HorizontalOptions="Center"
                       VerticalOptions="Center">
                    <Image.Source>
                        <FontImageSource FontFamily="SegoeMDL2"
                                         Glyph="&#xE708;"
                                         Size="22"
                                         Color="{DynamicResource SecondaryTextColor}"/>
                    </Image.Source>
                </Image>
            </Grid>

            <Border Grid.Row="2"
                    x:Name="LogoutButton"
                    StrokeShape="RoundRectangle 12"
                    IsVisible="true"
                    Padding="20,14"
                    HorizontalOptions="Center">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnLogoutClicked"/>
                </Border.GestureRecognizers>
                <Border.Background>
                    <SolidColorBrush Color="#DC362E"/>
                </Border.Background>
                <Border.Shadow>
                    <Shadow Brush="#DC362E" Opacity="0.3" Radius="10" Offset="0,3" />
                </Border.Shadow>
                <Label Text="DÃ©connexion" 
                       FontSize="15"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </Border>
        </Grid>
    </Shell.FlyoutFooter>

</Shell>
