<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="mobile.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:sf="clr-namespace:Syncfusion.Maui.Toolkit.SegmentedControl;assembly=Syncfusion.Maui.Toolkit"
    xmlns:auth="clr-namespace:mobile.Pages.Auth"
    xmlns:pages="clr-namespace:mobile.Pages"
    Shell.FlyoutBehavior="Flyout">

    <!-- ðŸŽ¨ Menu Items - Modern Card Style -->
    <Shell.ItemTemplate>
        <DataTemplate>
            <Grid Padding="12,4">
                <Border x:Name="ItemCard"
                        BackgroundColor="{AppThemeBinding Light=White, Dark=#1C1C1E}"
                        StrokeThickness="0"
                        Margin="12,6"
                        Padding="16,14"
                        HeightRequest="60"
                        StrokeShape="RoundRectangle 12">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Radius="12" Offset="0,2" />
                    </Border.Shadow>
                    
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="14">
                        <Border Grid.Column="0"
                                WidthRequest="40"
                                HeightRequest="40"
                                StrokeThickness="0"
                                BackgroundColor="{AppThemeBinding Light=#F5F5F7, Dark=#2C2C2E}"
                                StrokeShape="RoundRectangle 10">
                            <Image x:Name="MenuIcon"
                                   Source="{Binding FlyoutIcon}"
                                   WidthRequest="22"
                                   HeightRequest="22"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"
                                   Opacity="0.85"/>
                        </Border>
                        
                        <Label Grid.Column="1"
                               x:Name="MenuTitle"
                               Text="{Binding Title}"
                               FontSize="16"
                               FontAttributes="None"
                               TextColor="{AppThemeBinding Light=#1C1C1E, Dark=#F5F5F7}"
                               VerticalOptions="Center"/>
                        
                        <Label Grid.Column="2"
                               x:Name="SelectionChevron"
                               Text="â€º"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="#667eea"
                               VerticalOptions="Center"
                               Opacity="0"/>
                    </Grid>
                </Border>
                
                <Grid.Triggers>
                    <DataTrigger TargetType="Grid" Binding="{Binding IsChecked}" Value="True">
                        <Setter TargetName="ItemCard" Property="Border.BackgroundColor" Value="#EEF0FF"/>
                        <Setter TargetName="ItemCard" Property="Border.Stroke" Value="#667eea"/>
                        <Setter TargetName="ItemCard" Property="Border.StrokeThickness" Value="2"/>
                        <Setter TargetName="MenuIcon" Property="Image.Opacity" Value="1"/>
                        <Setter TargetName="MenuTitle" Property="Label.FontAttributes" Value="Bold"/>
                        <Setter TargetName="MenuTitle" Property="Label.TextColor" Value="#667eea"/>
                        <Setter TargetName="SelectionChevron" Property="Label.Opacity" Value="1"/>
                    </DataTrigger>
                </Grid.Triggers>
            </Grid>
        </DataTemplate>
    </Shell.ItemTemplate>

    <!-- Header moderne -->
    <Shell.FlyoutHeader>
        <Grid HeightRequest="200" Padding="0">
            <!-- Gradient Background avec effet Acrylic -->
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#5B5FC7" Offset="0.0" />
                    <GradientStop Color="#764BA2" Offset="1.0" />
                </LinearGradientBrush>
            </Grid.Background>
            
            <BoxView BackgroundColor="Black" Opacity="0.15" />
            
            <Grid Padding="24,24,24,20" RowDefinitions="Auto,*,Auto">
                <HorizontalStackLayout Grid.Row="0" Spacing="10">
                    <Label Text="â˜ï¸" 
                           FontSize="28" 
                           VerticalOptions="Center"/>
                    <Label Text="WeatherForecast" 
                           FontSize="17" 
                           FontAttributes="Bold"
                           TextColor="White"
                           Opacity="0.98"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>
                
                <HorizontalStackLayout Grid.Row="1" Spacing="18" VerticalOptions="Center">
                    <Border StrokeShape="RoundRectangle 36"
                            BackgroundColor="White"
                            WidthRequest="72"
                            HeightRequest="72"
                            StrokeThickness="4"
                            Stroke="#FFFFFF">
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.3" Radius="16" Offset="0,4" />
                        </Border.Shadow>
                        <Label x:Name="UserInitialsLabel"
                               FontSize="27"
                               FontAttributes="Bold"
                               TextColor="#5B5FC7"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Opacity="0"
                               Scale="0.5"/>
                    </Border>
                    
                    <VerticalStackLayout VerticalOptions="Center" Spacing="6" MaximumWidthRequest="190">
                        <Label x:Name="UserFullNameLabel"
                               FontSize="19"
                               FontAttributes="Bold"
                               TextColor="White"
                               LineBreakMode="TailTruncation"
                               Opacity="0"
                               TranslationX="-30"/>
                        <Label x:Name="UserEmailLabel"
                               FontSize="14"
                               TextColor="White"
                               LineBreakMode="TailTruncation"
                               Opacity="0"
                               TranslationX="-30"/>
                    </VerticalStackLayout>
                </HorizontalStackLayout>
                
                <BoxView Grid.Row="2" 
                         HeightRequest="1" 
                         BackgroundColor="White" 
                         Opacity="0.25"
                         Margin="0,12,0,0"/>
            </Grid>
        </Grid>
    </Shell.FlyoutHeader>

    <!-- Page principale (Dashboard) -->
    <ShellContent
        Title="Dashboard"
        Icon="{StaticResource IconDashboard}"
        ContentTemplate="{DataTemplate pages:MainPage}"
        Route="main" />

    <!-- Page des prÃ©visions mÃ©tÃ©o -->
    <ShellContent
        Title="PrÃ©visions"
        Icon="{StaticResource IconDashboard}"
        ContentTemplate="{DataTemplate pages:ForecastsPage}"
        Route="forecasts" />

    <!-- Page de connexion (jamais visible dans le menu) -->
    <ShellContent
        x:Name="LoginItem"
        Title="Connexion"
        Icon="{StaticResource IconDashboard}"
        ContentTemplate="{DataTemplate auth:LoginPage}"
        Route="login"
        FlyoutItemIsVisible="False" />

    <!-- Footer moderne -->
    <Shell.FlyoutFooter>
        <Grid Padding="24,20,24,24" RowDefinitions="Auto,Auto,Auto" RowSpacing="18">
            <BoxView Grid.Row="0" 
                     HeightRequest="1" 
                     BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark=#2C2C2E}" 
                     Opacity="0.6"
                     Margin="0,0,0,8"/>
            
            <HorizontalStackLayout Grid.Row="1" 
                                  Spacing="14" 
                                  HorizontalOptions="Center">
                <Label FontSize="15"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark=#8E8E93}"/>
                
                <sf:SfSegmentedControl x:Name="ThemeSegmentedControl" 
                                      VerticalOptions="Center" 
                                      SelectionChanged="SfSegmentedControl_SelectionChanged"
                                      SegmentWidth="44" 
                                      SegmentHeight="44">
                    <sf:SfSegmentedControl.ItemsSource>
                        <x:Array Type="{x:Type sf:SfSegmentItem}">
                            <sf:SfSegmentItem ImageSource="{StaticResource IconLight}"/>
                            <sf:SfSegmentItem ImageSource="{StaticResource IconDark}"/>
                        </x:Array>
                    </sf:SfSegmentedControl.ItemsSource>
                </sf:SfSegmentedControl>
            </HorizontalStackLayout>
            
            <Border Grid.Row="2"
                    x:Name="LogoutButton"
                    StrokeShape="RoundRectangle 12"
                    StrokeThickness="0"
                    HeightRequest="52"
                    IsVisible="False">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnLogoutClicked"/>
                </Border.GestureRecognizers>
                <Border.Background>
                    <SolidColorBrush Color="#DC362E"/>
                </Border.Background>
                <Border.Shadow>
                    <Shadow Brush="#DC362E" Opacity="0.3" Radius="10" Offset="0,3" />
                </Border.Shadow>
                
                <Label Text="DÃ©connexion" 
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </Border>
        </Grid>
    </Shell.FlyoutFooter>

</Shell>
