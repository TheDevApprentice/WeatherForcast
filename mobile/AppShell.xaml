<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="mobile.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:sf="clr-namespace:Syncfusion.Maui.Toolkit.SegmentedControl;assembly=Syncfusion.Maui.Toolkit"
    xmlns:auth="clr-namespace:mobile.Pages.Auth"
    xmlns:pages="clr-namespace:mobile.Pages"
    xmlns:controls="clr-namespace:mobile.Controls"
    Shell.FlyoutBehavior="Flyout">

    <!-- ðŸŽ¨ Menu Items - Modern Card Style -->
    <Shell.ItemTemplate>
        <DataTemplate>
            <Grid>
                <Border x:Name="ItemCard"
                        BackgroundColor="{AppThemeBinding Light=White, Dark=#1C1C1E}"
                        StrokeThickness="0"
                        Padding="12,14"
                        MinimumHeightRequest="50"
                        HorizontalOptions="FillAndExpand"
                        StrokeShape="RoundRectangle 12">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Radius="12" Offset="0,2" />
                    </Border.Shadow>
                    
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="14" HorizontalOptions="FillAndExpand">
                        <Border Grid.Column="0"
                                WidthRequest="40"
                                HeightRequest="40"
                                StrokeThickness="0"
                                BackgroundColor="{AppThemeBinding Light=#F5F5F7, Dark=#2C2C2E}"
                                StrokeShape="RoundRectangle 10">
                            <Image x:Name="MenuIcon"
                                   Source="{Binding FlyoutIcon}"
                                   WidthRequest="22"
                                   HeightRequest="22"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"
                                   Opacity="0.85"/>
                        </Border>
                        
                        <Label Grid.Column="1"
                               x:Name="MenuTitle"
                               Text="{Binding Title}"
                               FontSize="16"
                               FontAttributes="None"
                               TextColor="{AppThemeBinding Light=#1C1C1E, Dark=#F5F5F7}"
                               VerticalOptions="Center"
                               LineBreakMode="TailTruncation"/>
                        
                        <Label Grid.Column="2"
                               x:Name="SelectionChevron"
                               Text="â€º"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="#667eea"
                               VerticalOptions="Center"
                               Opacity="0"/>
                    </Grid>
                </Border>
                
                <Grid.Triggers>
                    <DataTrigger TargetType="Grid" Binding="{Binding IsChecked}" Value="True">
                        <Setter TargetName="ItemCard" Property="Border.BackgroundColor" Value="#EEF0FF"/>
                        <Setter TargetName="ItemCard" Property="Border.Stroke" Value="#667eea"/>
                        <Setter TargetName="ItemCard" Property="Border.StrokeThickness" Value="2"/>
                        <Setter TargetName="MenuIcon" Property="Image.Opacity" Value="1"/>
                        <Setter TargetName="MenuTitle" Property="Label.FontAttributes" Value="Bold"/>
                        <Setter TargetName="MenuTitle" Property="Label.TextColor" Value="#667eea"/>
                        <Setter TargetName="SelectionChevron" Property="Label.Opacity" Value="1"/>
                    </DataTrigger>
                </Grid.Triggers>
            </Grid>
        </DataTemplate>
    </Shell.ItemTemplate>

    <!-- Header moderne -->
    <Shell.FlyoutHeader>
        <Grid HeightRequest="200" Padding="0">
            <!-- Gradient Background avec effet Acrylic -->
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="{AppThemeBinding Light=#5B5FC7, Dark=#2C2C2E}" Offset="0.0" />
                    <GradientStop Color="{AppThemeBinding Light=#5764BA2, Dark=#2C2C2E}" Offset="1.0" />
                </LinearGradientBrush>
            </Grid.Background>
            
            <BoxView BackgroundColor="Black" Opacity="0.15" />
            
            <Grid Padding="24,24,24,20" RowDefinitions="Auto,*,Auto">
                <HorizontalStackLayout Grid.Row="0" Spacing="10">
                    <Label Text="â˜ï¸" 
                           FontSize="28" 
                           VerticalOptions="Center"/>
                    <Label Text="WeatherForecast" 
                           FontSize="17" 
                           FontAttributes="Bold"
                           TextColor="White"
                           Opacity="0.98"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>
                
                <HorizontalStackLayout Grid.Row="1" Spacing="18" VerticalOptions="Center">
                    <Border StrokeShape="RoundRectangle 36"
                            BackgroundColor="White"
                            WidthRequest="72"
                            HeightRequest="72"
                            StrokeThickness="4"
                            Stroke="#FFFFFF">
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.3" Radius="16" Offset="0,4" />
                        </Border.Shadow>
                        <Label x:Name="UserInitialsLabel"
                               FontSize="27"
                               FontAttributes="Bold"
                               TextColor="#5B5FC7"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Opacity="0"
                               Scale="0.5"/>
                    </Border>
                    
                    <VerticalStackLayout VerticalOptions="Center" Spacing="6" MaximumWidthRequest="190">
                        <Label x:Name="UserFullNameLabel"
                               FontSize="19"
                               FontAttributes="Bold"
                               TextColor="White"
                               LineBreakMode="TailTruncation"
                               Opacity="0"
                               TranslationX="-30"/>
                        <Label x:Name="UserEmailLabel"
                               FontSize="14"
                               TextColor="White"
                               LineBreakMode="TailTruncation"
                               Opacity="0"
                               TranslationX="-30"/>
                    </VerticalStackLayout>
                </HorizontalStackLayout>
                
                <BoxView Grid.Row="2" 
                         HeightRequest="1" 
                         BackgroundColor="White" 
                         Opacity="0.25"
                         Margin="0,12,0,0"/>
            </Grid>
        </Grid>
    </Shell.FlyoutHeader>

    <!-- Page principale (Dashboard) -->
    <ShellContent
        Title="Dashboard"
        Icon="{StaticResource IconDashboard}"
        ContentTemplate="{DataTemplate pages:MainPage}"
        Route="main" />

    <!-- Page des prÃ©visions mÃ©tÃ©o -->
    <ShellContent
        Title="PrÃ©visions"
        Icon="{StaticResource IconDashboard}"
        ContentTemplate="{DataTemplate pages:ForecastsPage}"
        Route="forecasts" />

    <!-- Page de dÃ©marrage (Splash) - jamais visible dans le menu -->
    <ShellContent
        x:Name="SplashItem"
        Title="Chargement"
        ContentTemplate="{DataTemplate pages:SplashPage}"
        Route="splash"
        FlyoutItemIsVisible="False" />

    <!-- Page de connexion (jamais visible dans le menu) -->
    <ShellContent
        x:Name="LoginItem"
        Title="Connexion"
        Icon="{StaticResource IconDashboard}"
        ContentTemplate="{DataTemplate auth:LoginPage}"
        Route="login"
        FlyoutItemIsVisible="False" />

    <!-- Footer moderne -->
    <Shell.FlyoutFooter>
        <Grid Padding="24,20,24,24" RowDefinitions="Auto,Auto,Auto" RowSpacing="18">
            <BoxView Grid.Row="0" 
                     HeightRequest="1" 
                     BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark=#2C2C2E}" 
                     Opacity="0.6"
                     Margin="0,0,0,8"/>
            
            <!-- Theme toggle row: switch centered across full flyout width, icons on both sides -->
            <Grid Grid.Row="1" ColumnDefinitions="*,Auto,*" ColumnSpacing="14" HorizontalOptions="FillAndExpand" VerticalOptions="Center" HeightRequest="32">
                <!-- Left icon container ensures equal visual weight -->
                <Grid Grid.Column="0" HorizontalOptions="FillAndExpand" VerticalOptions="Center">
                    <Image WidthRequest="22"
                           HeightRequest="22"
                           HorizontalOptions="End"
                           VerticalOptions="Center"
                           InputTransparent="True">
                        <Image.Source>
                            <FontImageSource FontFamily="SegoeMDL2"
                                             Glyph="&#xE706;"
                                             Size="18"
                                             Color="{AppThemeBinding Light={StaticResource Gray600}, Dark=#8E8E93}"/>
                        </Image.Source>
                    </Image>
                </Grid>

                <!-- Centered switch -->
                <Switch Grid.Column="1"
                        x:Name="ThemeSwitch"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        Toggled="ThemeSwitch_Toggled" />

                <!-- Right icon container mirrors the left -->
                <Grid Grid.Column="2" HorizontalOptions="FillAndExpand" VerticalOptions="Center">
                    <Image WidthRequest="22"
                           HeightRequest="22"
                           HorizontalOptions="Start"
                           VerticalOptions="Center"
                           InputTransparent="True">
                        <Image.Source>
                            <FontImageSource FontFamily="SegoeMDL2"
                                             Glyph="&#xE708;"
                                             Size="18"
                                             Color="{AppThemeBinding Light={StaticResource Gray600}, Dark=#8E8E93}"/>
                        </Image.Source>
                    </Image>
                </Grid>
            </Grid>

            <Border Grid.Row="2"
                    x:Name="LogoutButton"
                    StrokeShape="RoundRectangle 12"
                    IsVisible="true">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnLogoutClicked"/>
                </Border.GestureRecognizers>
                <Border.Background>
                    <SolidColorBrush Color="#DC362E"/>
                </Border.Background>
                <Border.Shadow>
                    <Shadow Brush="#DC362E" Opacity="0.3" Radius="10" Offset="0,3" />
                </Border.Shadow>
                <HorizontalStackLayout Grid.Row="1" 
                                  Spacing="14" 
                                   MaximumWidthRequest="150"
                                   MinimumWidthRequest="100"
                                  HorizontalOptions="Center"
                                   VerticalOptions="Center">
                    <Label Text="DÃ©connexion" 
                       FontSize="13"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>

                    <!-- Logout glyph (MDL2) -->
                    <Image WidthRequest="22"
                            HeightRequest="22"
                            VerticalOptions="Center"
                            HorizontalOptions="Center"
                            InputTransparent="True">
                        <Image.Source>
                            <FontImageSource FontFamily="SegoeMDL2"
                                  Glyph="&#xE726;"
                                  Size="18"
                                  Color="{AppThemeBinding Light=Black, Dark=Black}"/>
                        </Image.Source>
                    </Image>
                </HorizontalStackLayout>
            </Border>
        </Grid>
    </Shell.FlyoutFooter>

</Shell>
