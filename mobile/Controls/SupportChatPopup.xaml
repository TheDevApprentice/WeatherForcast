<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="mobile.Controls.SupportChatPopup"
             x:Name="Root"
             HorizontalOptions="End"
             VerticalOptions="End"
             Margin="0,0,20,20"
             IsVisible="False"
             Opacity="0">
    
    <!-- FenÃªtre de chat style Messenger (sans overlay) -->
    <Border x:Name="ChatWindow"
            WidthRequest="360"
            HeightRequest="500"
            BackgroundColor="{DynamicResource CardBackgroundColor}"
            StrokeThickness="0"
            StrokeShape="RoundRectangle 16"
            TranslationY="600">
            
            <Border.Shadow>
                <Shadow Brush="{DynamicResource ShadowColor}" 
                        Opacity="0.4" 
                        Radius="20" 
                        Offset="0,8" />
            </Border.Shadow>
            
            <Grid RowDefinitions="Auto,Auto,*,Auto">
                <!-- Header du chat -->
                <Border Grid.Row="0"
                        BackgroundColor="{DynamicResource CardBackgroundColor}"
                        Padding="5,1"
                        StrokeShape="RoundRectangle 16,16,0,0"
                        StrokeThickness="0">
                    
                    <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                        <!-- Infos conversation Support -->
                        <VerticalStackLayout Grid.Column="0"
                                             Spacing="2"
                                             VerticalOptions="Center">
                            <Label x:Name="ConversationTitleLabel"
                                   Text="Support"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource PrimaryTextColor}"
                                   LineBreakMode="TailTruncation"
                                   MaxLines="1"/>
                            <Label x:Name="ConversationSubtitleLabel"
                                   Text="Nous sommes lÃ  pour vous aider"
                                   FontSize="12"
                                   TextColor="{DynamicResource SecondaryTextColor}"
                                   LineBreakMode="TailTruncation"
                                   MaxLines="1"/>
                        </VerticalStackLayout>
                        
                        <!-- Bouton Video Call -->
                        <ImageButton Grid.Column="1"
                                     HeightRequest="30"
                                     WidthRequest="30"
                                     Padding="0"
                                     Margin="10,0,5,0"
                                     BorderColor="{DynamicResource BorderColor}"
                                     BorderWidth="1.5"
                                     CornerRadius="20"
                                     Background="{DynamicResource PageBackgroundColor}">
                            <ImageButton.Source>
                                <FontImageSource Size="18"
                                                 Glyph="&#xE714;"
                                                 FontFamily="SegoeMDL2"
                                                 Color="{DynamicResource TitleBarForeground}" />
                            </ImageButton.Source>
                        </ImageButton>
                        
                        <!-- Bouton Phone Call -->
                        <ImageButton Grid.Column="2"
                                     HeightRequest="30"
                                     WidthRequest="30"
                                     Padding="0"
                                     Margin="0,0,5,0"
                                     BorderColor="{DynamicResource BorderColor}"
                                     BorderWidth="1.5"
                                     CornerRadius="20"
                                     Background="{DynamicResource PageBackgroundColor}">
                            <ImageButton.Source>
                                <FontImageSource Size="18"
                                                 Glyph="&#xE717;"
                                                 FontFamily="SegoeMDL2"
                                                 Color="{DynamicResource TitleBarForeground}" />
                            </ImageButton.Source>
                        </ImageButton>
                        
                        <!-- Bouton fermer -->
                        <ImageButton Grid.Column="3"
                                     HeightRequest="30"
                                     WidthRequest="30"
                                     Padding="0"
                                     Margin="0,0,0,0"
                                     BorderColor="{DynamicResource BorderColor}"
                                     BorderWidth="1.5"
                                     CornerRadius="20"
                                     Background="{DynamicResource PageBackgroundColor}"
                                     Clicked="OnCloseClicked">
                            <ImageButton.Source>
                                <FontImageSource Size="18"
                                                 Glyph="&#xE711;"
                                                 FontFamily="SegoeMDL2"
                                                 Color="{DynamicResource TitleBarForeground}" />
                            </ImageButton.Source>
                        </ImageButton>
                    </Grid>
                </Border>
                
                <!-- SÃ©parateur -->
                <BoxView Grid.Row="1"
                         HeightRequest="1"
                         BackgroundColor="{DynamicResource BorderColor}"
                         Opacity="0.3"/>
                
                <!-- Messages -->
                <ScrollView Grid.Row="2"
                            x:Name="MessagesScrollView"
                            Padding="0">
                    <VerticalStackLayout Spacing="0">
                        <!-- Section FAQ -->
                        <VerticalStackLayout Padding="16,12,16,8"
                                             Spacing="8">
                            <!-- Header FAQ avec bouton toggle -->
                            <Grid ColumnDefinitions="*,Auto"
                                  Margin="0,0,0,4">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnToggleFaqClicked"/>
                                </Grid.GestureRecognizers>
                                
                                <Label Grid.Column="0"
                                       Text="Questions frÃ©quentes"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource SecondaryTextColor}"/>
                                
                                <Label Grid.Column="1"
                                       x:Name="FaqToggleIcon"
                                       Text="â–¼"
                                       FontSize="12"
                                       TextColor="{DynamicResource SecondaryTextColor}"
                                       HorizontalOptions="End"/>
                            </Grid>
                            
                            <!-- Liste des FAQ (collapsible) -->
                            <VerticalStackLayout x:Name="FaqList"
                                                 Spacing="8"
                                                 IsVisible="True">
                                <!-- FAQ 1 -->
                                <Border BackgroundColor="{DynamicResource CardBackgroundColor}"
                                        StrokeThickness="1"
                                        Stroke="{DynamicResource BorderColor}"
                                        StrokeShape="RoundRectangle 8"
                                        Padding="12,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnFaqTapped" CommandParameter="Comment rÃ©initialiser mon mot de passe ?"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="ðŸ’¡ Comment rÃ©initialiser mon mot de passe ?"
                                           FontSize="13"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                </Border>
                                
                                <!-- FAQ 2 -->
                                <Border BackgroundColor="{DynamicResource CardBackgroundColor}"
                                        StrokeThickness="1"
                                        Stroke="{DynamicResource BorderColor}"
                                        StrokeShape="RoundRectangle 8"
                                        Padding="12,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnFaqTapped" CommandParameter="Comment mettre Ã  jour mes informations ?"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="ðŸ’¡ Comment mettre Ã  jour mes informations ?"
                                           FontSize="13"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                </Border>
                                
                                <!-- FAQ 3 -->
                                <Border BackgroundColor="{DynamicResource CardBackgroundColor}"
                                        StrokeThickness="1"
                                        Stroke="{DynamicResource BorderColor}"
                                        StrokeShape="RoundRectangle 8"
                                        Padding="12,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnFaqTapped" CommandParameter="Comment contacter le support technique ?"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="ðŸ’¡ Comment contacter le support technique ?"
                                           FontSize="13"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                </Border>
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                        
                        <!-- SÃ©parateur FAQ / Messages -->
                        <BoxView HeightRequest="1"
                                 BackgroundColor="{DynamicResource BorderColor}"
                                 Opacity="0.2"
                                 Margin="16,8"/>
                        
                        <!-- Messages -->
                        <VerticalStackLayout x:Name="MessagesList"
                                             Spacing="8"
                                             Padding="16,0,16,12">
                            <!-- Messages seront ajoutÃ©s ici dynamiquement -->
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </ScrollView>
                
                <!-- Zone de saisie du message -->
                <Border Grid.Row="3"
                        Background="Transparent"
                        Padding="12"
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 0,0,16,16">
                    
                    <Grid ColumnDefinitions="*,Auto">
                        <!-- Champ de saisie -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource PageBackgroundColor}"
                                StrokeThickness="1"
                                Stroke="{DynamicResource PrimaryTextColor}"
                                StrokeShape="RoundRectangle 20"
                                Padding="12,8">
                            <Entry x:Name="MessageEntry"
                                   FontSize="14"
                                   Placeholder="Ã‰crivez votre message..."
                                   PlaceholderColor="{DynamicResource TertiaryTextColor}"
                                   TextColor="{DynamicResource PrimaryTextColor}"
                                   Background="Transparent"
                                   MaxLength="500"
                                   Completed="OnSendMessage"
                                   VerticalOptions="Center"/>
                        </Border>
                        
                        <!-- Bouton envoyer -->
                        <Button Grid.Column="1"
                                x:Name="SendButton"
                                Text="âž¤"
                                FontSize="20"
                                WidthRequest="48"
                                HeightRequest="48"
                                CornerRadius="24"
                                BackgroundColor="{DynamicResource AccentColor}"
                                TextColor="White"
                                Margin="8,0,0,0"
                                Clicked="OnSendMessage"/>
                    </Grid>
                </Border>
            </Grid>
    </Border>
</ContentView>
