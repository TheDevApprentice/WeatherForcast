<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:buttons="clr-namespace:mobile.Controls"
             x:Class="mobile.Controls.SupportChatPopup"
             x:Name="Root"
             Opacity="0"
             IsVisible="False">
    <ContentView.Margin>
        <OnPlatform x:TypeArguments="Thickness">
            <On Platform="WinUI, MacCatalyst" Value="0,0,20,20"/>
            <On Platform="Android, iOS" Value="0"/>
        </OnPlatform>
    </ContentView.Margin>
    <ContentView.HorizontalOptions>
        <OnPlatform x:TypeArguments="LayoutOptions">
            <On Platform="WinUI, MacCatalyst" Value="End"/>
            <On Platform="Android, iOS" Value="Fill"/>
        </OnPlatform>
    </ContentView.HorizontalOptions>
    <ContentView.VerticalOptions>
        <OnPlatform x:TypeArguments="LayoutOptions">
            <On Platform="WinUI, MacCatalyst" Value="End"/>
            <On Platform="Android, iOS" Value="Fill"/>
        </OnPlatform>
    </ContentView.VerticalOptions>

    <!-- FenÃªtre de chat style Messenger (sans overlay) -->
    <Border x:Name="ChatWindow"
            BackgroundColor="{DynamicResource CardBackgroundColor}"
            StrokeThickness="0">
        <Border.StrokeShape>
            <OnPlatform x:TypeArguments="Shape">
                <On Platform="WinUI, MacCatalyst">
                    <RoundRectangle CornerRadius="16"/>
                </On>
                <On Platform="Android, iOS">
                    <RoundRectangle CornerRadius="0"/>
                </On>
            </OnPlatform>
        </Border.StrokeShape>
        <Border.MaximumWidthRequest>
            <OnPlatform x:TypeArguments="x:Double">
                <On Platform="WinUI, MacCatalyst" Value="360"/>
                <On Platform="Android, iOS" Value="{x:Static x:Double.PositiveInfinity}"/>
            </OnPlatform>
        </Border.MaximumWidthRequest>
        <Border.MaximumHeightRequest>
            <OnPlatform x:TypeArguments="x:Double">
                <On Platform="WinUI, MacCatalyst" Value="500"/>
                <On Platform="Android, iOS" Value="{x:Static x:Double.PositiveInfinity}"/>
            </OnPlatform>
        </Border.MaximumHeightRequest>
        <Border.Shadow>
                <Shadow Brush="{DynamicResource ShadowColor}" 
                        Opacity="0.4" 
                        Radius="20" 
                        Offset="0,8" />
            </Border.Shadow>
            
            <Grid RowDefinitions="Auto,Auto,*,Auto">
                <!-- Header du chat -->
                <Border Grid.Row="0"
                        BackgroundColor="{DynamicResource CardBackgroundColor}"
                        Padding="5,1"
                        StrokeShape="RoundRectangle 16,16,0,0"
                        StrokeThickness="0"
                        Margin="0,0,0,0">
                    
                    <Grid ColumnDefinitions="*,Auto,Auto,Auto" Margin="0,0,0,10">
                        <!-- Infos conversation Support -->
                        <VerticalStackLayout Grid.Column="0"
                                             Spacing="2"
                                             VerticalOptions="Center">
                            <Label x:Name="ConversationTitleLabel"
                                   Text="Support"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource PrimaryTextColor}"
                                   LineBreakMode="TailTruncation"
                                   MaxLines="1"/>
                            <Label x:Name="ConversationSubtitleLabel"
                                   Text="Nous sommes lÃ  pour vous aider"
                                   FontSize="12"
                                   TextColor="{DynamicResource SecondaryTextColor}"
                                   LineBreakMode="TailTruncation"
                                   MaxLines="1"/>
                        </VerticalStackLayout>
                        
                        <!-- Bouton Video Call -->
                        <buttons:CircularBorderedIconButton Grid.Column="1"
                                                            Glyph="&#xE714;"
                                                            IconColor="{DynamicResource PrimaryTextColor}"
                                                            MarginValue="0,0,5,0"
                                                          />
                        
                        <!-- Bouton Phone Call -->
                        <buttons:CircularBorderedIconButton Grid.Column="2"
                                                            Glyph="&#xE717;"
                                                            IconColor="{DynamicResource PrimaryTextColor}"
                                                            MarginValue="0,0,5,0"/>
                        
                        <!-- Bouton fermer -->
                        <buttons:CircularBorderedIconButton Grid.Column="3"
                                                            Glyph="&#xE711;"
                                                            IconColor="{DynamicResource PrimaryTextColor}"
                                                            Clicked="OnCloseClicked"
                                                            MarginValue="0,0,5,0"
                                                            />
                    </Grid>
                </Border>
                
                <!-- SÃ©parateur -->
                <BoxView Grid.Row="1"
                         HeightRequest="1"
                         BackgroundColor="{DynamicResource BorderColor}"
                         Opacity="0.3"/>
                
                <!-- Messages -->
                <ScrollView Grid.Row="2"
                            x:Name="MessagesScrollView"
                            Padding="0">
                    <VerticalStackLayout Spacing="0">
                        <!-- Section FAQ -->
                        <VerticalStackLayout Padding="16,12,16,8"
                                             Spacing="8">
                            <!-- Header FAQ avec bouton toggle -->
                            <Grid ColumnDefinitions="*,Auto"
                                  Margin="0,0,0,4">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnToggleFaqClicked"/>
                                </Grid.GestureRecognizers>
                                
                                <Label Grid.Column="0"
                                       Text="Questions frÃ©quentes"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource SecondaryTextColor}"/>
                                
                                <Label Grid.Column="1"
                                       x:Name="FaqToggleIcon"
                                       Text="â–²"
                                       FontSize="12"
                                       TextColor="{DynamicResource SecondaryTextColor}"
                                       HorizontalOptions="End"/>
                            </Grid>
                            
                            <!-- Liste des FAQ (collapsible) -->
                            <VerticalStackLayout x:Name="FaqList"
                                                 Spacing="8"
                                                 IsVisible="True">
                                <!-- FAQ 1 -->
                                <Border BackgroundColor="{DynamicResource CardBackgroundColor}"
                                        StrokeThickness="1"
                                        Stroke="{DynamicResource BorderColor}"
                                        StrokeShape="RoundRectangle 8"
                                        Padding="12,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnFaqTapped" CommandParameter="Comment rÃ©initialiser mon mot de passe ?"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="ðŸ’¡ Comment rÃ©initialiser mon mot de passe ?"
                                           FontSize="13"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                </Border>
                                
                                <!-- FAQ 2 -->
                                <Border BackgroundColor="{DynamicResource CardBackgroundColor}"
                                        StrokeThickness="1"
                                        Stroke="{DynamicResource BorderColor}"
                                        StrokeShape="RoundRectangle 8"
                                        Padding="12,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnFaqTapped" CommandParameter="Comment mettre Ã  jour mes informations ?"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="ðŸ’¡ Comment mettre Ã  jour mes informations ?"
                                           FontSize="13"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                </Border>
                                
                                <!-- FAQ 3 -->
                                <Border BackgroundColor="{DynamicResource CardBackgroundColor}"
                                        StrokeThickness="1"
                                        Stroke="{DynamicResource BorderColor}"
                                        StrokeShape="RoundRectangle 8"
                                        Padding="12,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnFaqTapped" CommandParameter="Comment contacter le support technique ?"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="ðŸ’¡ Comment contacter le support technique ?"
                                           FontSize="13"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                </Border>
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                        
                        <!-- SÃ©parateur FAQ / Messages -->
                        <BoxView HeightRequest="1"
                                 BackgroundColor="{DynamicResource BorderColor}"
                                 Opacity="0.2"
                                 Margin="16,8"/>
                        
                        <!-- Messages -->
                        <VerticalStackLayout x:Name="MessagesList"
                                             Spacing="8"
                                             Padding="16,0,16,12">
                            <!-- Messages seront ajoutÃ©s ici dynamiquement -->
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </ScrollView>
                
                <!-- Zone de saisie du message -->
                <Border Grid.Row="3"
                        Background="Transparent"
                        Padding="0"
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 0,0,16,16">
                    
                    <Grid ColumnDefinitions="*,Auto">
                        <!-- Champ de saisie -->
                        <Border Grid.Column="0"
                                Background="Transparent"
                                StrokeThickness="1"
                                Stroke="{DynamicResource TertiaryTextColor}"
                                StrokeShape="RoundRectangle 20"
                                Padding="12,8">
                            <Entry x:Name="MessageEntry"
                                   FontSize="14"
                                   Placeholder="Ã‰crivez votre message..."
                                   PlaceholderColor="{DynamicResource TertiaryTextColor}"
                                   TextColor="{DynamicResource PrimaryTextColor}"
                                   Background="Transparent"
                                   MaxLength="500"
                                   TextChanged="OnMessageTextChanged"
                                   Completed="OnSendMessage"
                                   VerticalOptions="Center"/>
                        </Border>
                        
                        <!-- Bouton envoyer -->
                        <Button Grid.Column="1"
                                x:Name="SendButton"
                                Text="âž¤"
                                FontSize="20"
                                WidthRequest="48"
                                HeightRequest="48"
                                CornerRadius="24"
                                TextColor="White"
                                Margin="8,0,0,0"
                                IsEnabled="False"
                                Clicked="OnSendMessage"/>
                </Grid>
                </Border>
            </Grid>
    </Border>
</ContentView>
