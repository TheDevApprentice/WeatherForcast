<?xml version="1.0" encoding="utf-8" ?>
<Border xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
        xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
        xmlns:models="clr-namespace:mobile.Models"
        x:Class="mobile.Controls.ConversationCard"
        x:DataType="models:Conversation"
        BackgroundColor="{DynamicResource CardBackgroundColor}"
        Padding="16,12"
        Margin="0"
        StrokeThickness="1"
        Stroke="{DynamicResource BorderColor}">
    
    <!-- Fond diffÃ©rent si non lu -->
    <Border.Triggers>
        <DataTrigger TargetType="Border"
                     Binding="{Binding HasUnreadMessages}"
                     Value="True">
            <Setter Property="BackgroundColor" 
                    Value="{DynamicResource SelectedItemBackground}"/>
        </DataTrigger>
    </Border.Triggers>
    
    <Border.GestureRecognizers>
        <TapGestureRecognizer Tapped="OnConversationTapped"/>
    </Border.GestureRecognizers>
    
    <Grid ColumnDefinitions="Auto,*,Auto"
          ColumnSpacing="12"
          RowDefinitions="Auto,Auto"
          RowSpacing="4">
        
        <!-- Avatar avec initiales -->
        <Border Grid.Column="0"
                Grid.RowSpan="2"
                WidthRequest="48"
                HeightRequest="48"
                BackgroundColor="{DynamicResource AccentColor}"
                StrokeShape="RoundRectangle 24"
                StrokeThickness="0"
                VerticalOptions="Center">
            <Label x:Name="InitialsLabel"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"/>
        </Border>
        
        <!-- Badge Ã©pinglÃ© (si conversation support ou Ã©pinglÃ©e) -->
        <Border Grid.Column="0"
                WidthRequest="18"
                HeightRequest="18"
                BackgroundColor="{DynamicResource CardBackgroundColor}"
                StrokeShape="RoundRectangle 9"
                StrokeThickness="2"
                Stroke="{DynamicResource AccentColor}"
                HorizontalOptions="End"
                VerticalOptions="Start"
                Margin="0,-4,-4,0"
                IsVisible="{Binding IsPinned}">
            <Label Text="ðŸ“Œ"
                   FontSize="10"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"/>
        </Border>
        
        <!-- Nom de la conversation -->
        <Label Grid.Column="1"
               Grid.Row="0"
               x:Name="DisplayNameLabel"
               FontSize="15"
               FontAttributes="Bold"
               TextColor="{DynamicResource PrimaryTextColor}"
               LineBreakMode="TailTruncation"
               MaxLines="1"/>
        
        <!-- Dernier message -->
        <Label Grid.Column="1"
               Grid.Row="1"
               x:Name="LastMessageLabel"
               FontSize="13"
               TextColor="{DynamicResource SecondaryTextColor}"
               LineBreakMode="TailTruncation"
               MaxLines="1"/>
        
        <!-- Timestamp -->
        <Label Grid.Column="2"
               Grid.Row="0"
               x:Name="TimestampLabel"
               FontSize="11"
               TextColor="{DynamicResource TertiaryTextColor}"
               Opacity="0.7"
               HorizontalOptions="End"
               VerticalOptions="Start"/>
        
        <!-- Badge "Non lu" avec compteur -->
        <Border Grid.Column="2"
                Grid.Row="1"
                MinimumWidthRequest="20"
                HeightRequest="20"
                Padding="6,2"
                BackgroundColor="#3B82F6"
                StrokeShape="RoundRectangle 10"
                StrokeThickness="0"
                HorizontalOptions="End"
                VerticalOptions="Center"
                IsVisible="{Binding HasUnreadMessages}">
            <Label x:Name="UnreadCountLabel"
                   FontSize="11"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"/>
        </Border>
    </Grid>
</Border>
