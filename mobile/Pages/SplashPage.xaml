<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:mobile.PageModels"
             x:Class="mobile.Pages.SplashPage"
             x:DataType="viewmodels:SplashPageModel"
             Shell.NavBarIsVisible="False"
             Shell.FlyoutBehavior="Disabled">
    
    <Grid>
        <!-- Fond avec gradient subtil et moderne -->
        <BoxView>
            <BoxView.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="{DynamicResource SplashGradientStart}" Offset="0.0" />
                    <GradientStop Color="{DynamicResource SplashGradientEnd}" Offset="1.0" />
                </LinearGradientBrush>
            </BoxView.Background>
        </BoxView>

        <!-- Zone de chargement ultra-centrée et minimaliste -->
        <VerticalStackLayout VerticalOptions="Center" 
                            HorizontalOptions="Center" 
                            Spacing="50">
            
            <!-- Loader avec effet de glow -->
            <Grid WidthRequest="80" HeightRequest="80">
                <!-- Cercle de fond avec glow -->
                <Ellipse Fill="{DynamicResource SplashLoaderBackground}"
                         WidthRequest="80"
                         HeightRequest="80"
                         Opacity="0.3"/>
                
                <!-- Indicateur de chargement -->
                <ActivityIndicator x:Name="LoadingIndicator"
                                 IsRunning="{Binding IsLoading}"
                                 Color="{DynamicResource Primary}"
                                 HeightRequest="48"
                                 WidthRequest="48"
                                 HorizontalOptions="Center"
                                 VerticalOptions="Center"/>
            </Grid>

            <!-- Étape en cours - Design épuré -->
            <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                    <!-- Icône avec Fluent Icons (cross-platform) -->
                    <Label x:Name="StatusIcon"
                           Text="{Binding StatusIcon}"
                           FontSize="18"
                           FontFamily="SegoeMDL2"
                           TextColor="{DynamicResource Primary}"
                           VerticalOptions="Center"/>
                    
                    <!-- Texte de l'étape -->
                    <Label x:Name="CurrentStepLabel"
                           Text="{Binding CurrentStepDescription}"
                           FontSize="16"
                           FontAttributes="None"
                           TextColor="{DynamicResource SplashStatusText}"
                           LineBreakMode="WordWrap"
                           MaxLines="2"
                           WidthRequest="280"
                           VerticalOptions="Center"
                           Opacity="0.9"/>
                </HorizontalStackLayout>
                
                <!-- Points de progression des étapes (générés dynamiquement) -->
                <HorizontalStackLayout x:Name="DotsContainer" 
                                      Spacing="10" 
                                      HorizontalOptions="Center"/>
            </VerticalStackLayout>
        </VerticalStackLayout>

        <!-- Message d'erreur minimaliste (en bas) -->
        <VerticalStackLayout x:Name="ErrorContainer"
                            IsVisible="{Binding HasError}"
                            Spacing="20"
                            Padding="32"
                            Margin="40,0,40,60"
                            VerticalOptions="End"
                            HorizontalOptions="Center">
            
            <!-- Icône d'erreur avec cercle -->
            <Grid WidthRequest="56" HeightRequest="56" HorizontalOptions="Center">
                <Ellipse Fill="{DynamicResource SplashErrorBackground}"
                         WidthRequest="56"
                         HeightRequest="56"/>
                <Label Text="\uEB90" 
                       FontFamily="SegoeMDL2"
                       FontSize="28"
                       TextColor="{DynamicResource SplashErrorText}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </Grid>
            
            <!-- Titre de l'erreur -->
            <Label Text="Impossible de démarrer" 
                   FontSize="20" 
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="{DynamicResource SplashErrorText}"/>
            
            <!-- Message d'erreur -->
            <Label x:Name="ErrorMessage" 
                   Text="{Binding ErrorMessage}"
                   TextColor="{DynamicResource SplashStatusText}"
                   FontSize="14"
                   HorizontalOptions="Center"
                   HorizontalTextAlignment="Center"
                   LineBreakMode="WordWrap"
                   MaxLines="3"
                   WidthRequest="320"/>
            
            <!-- Bouton réessayer moderne -->
            <Border BackgroundColor="{DynamicResource Primary}"
                    StrokeThickness="0"
                    Padding="24,14"
                    HorizontalOptions="Center"
                    Margin="0,8,0,0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12"/>
                </Border.StrokeShape>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding RetryCommand}"/>
                </Border.GestureRecognizers>
                
                <Label Text="Réessayer"
                       TextColor="White"
                       FontSize="15"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </Border>
        </VerticalStackLayout>
    </Grid>
</ContentPage>
