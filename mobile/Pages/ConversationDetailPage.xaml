<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:mobile.Models"
             xmlns:buttons="clr-namespace:mobile.Controls"
             x:Class="mobile.Pages.ConversationDetailPage"
             x:Name="Root"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{DynamicResource PageBackgroundColor}">
    
    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header avec infos de la conversation -->
        <Border Grid.Row="0"
                BackgroundColor="{DynamicResource CardBackgroundColor}"
                Padding="16,12"
                StrokeThickness="0"
                Margin="5,4,5,0">
            <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                <!-- Infos conversation -->
                <VerticalStackLayout Grid.Column="0"
                                     Spacing="2"
                                     VerticalOptions="Center"
                                     Margin="8,0,0,0">
                    <Label x:Name="ConversationTitleLabel"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{DynamicResource PrimaryTextColor}"
                           LineBreakMode="TailTruncation"
                           MaxLines="1"/>
                    <Label x:Name="ConversationSubtitleLabel"
                           FontSize="12"
                           TextColor="{DynamicResource SecondaryTextColor}"
                           LineBreakMode="TailTruncation"
                           MaxLines="1"/>
                </VerticalStackLayout>
                
                <buttons:CircularBorderedIconButton Grid.Column="1"
                                                    x:Name="VideoCall"
                                                    Glyph="&#xE714;"
                                                    MarginValue="0,0,5,0"
                                                    />
                <buttons:CircularBorderedIconButton Grid.Column="2"
                                                    x:Name="PhoneCall"
                                                    Glyph="&#xE717;"
                                                    MarginValue="0,0,5,0"
                                                    />
            </Grid>
        </Border>
        
        <!-- Liste des messages -->
        <ScrollView Grid.Row="1"
                    x:Name="MessagesScrollView">
            <VerticalStackLayout x:Name="MessagesList"
                                 Spacing="8"
                                 Padding="16">
                
                <!-- Empty view -->
                <Grid x:Name="EmptyView"
                      MinimumHeightRequest="400"
                      IsVisible="False">
                    <VerticalStackLayout Spacing="12"
                                         HorizontalOptions="Center"
                                         VerticalOptions="Center">
                        <Label Text="ðŸ’¬"
                               FontSize="48"
                               HorizontalOptions="Center"
                               Opacity="0.3"/>
                        <Label Text="Aucun message"
                               FontSize="16"
                               TextColor="{DynamicResource SecondaryTextColor}"
                               HorizontalOptions="Center"/>
                        <Label Text="Commencez la conversation"
                               FontSize="14"
                               TextColor="{DynamicResource TertiaryTextColor}"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Grid>
            </VerticalStackLayout>
        </ScrollView>
        
        <!-- Zone de saisie du message -->
        <Border Grid.Row="2"
                Background="Transparent"
                Padding="5"
                StrokeThickness="0"
                Margin="10,10,10,10">
            <Grid ColumnDefinitions="*,Auto">
                <!-- Champ de saisie -->
                <Border Grid.Column="0"
                        Background="{DynamicResource PageBackgroundColor}"
                        StrokeThickness="1"
                        Stroke="{DynamicResource PrimaryTextColor}"
                        StrokeShape="RoundRectangle 20"
                        Padding="12,8">
                    <Entry x:Name="MessageEntry"
                           FontSize="14"
                           Placeholder="Ã‰crivez votre message..."
                           PlaceholderColor="{DynamicResource TertiaryTextColor}"
                           TextColor="{DynamicResource PrimaryTextColor}"
                           Background="Transparent"
                           MaxLength="500"
                           ReturnCommand="{Binding Source={x:Reference Root}, Path=SendMessageCommand}"
                           VerticalOptions="Center"/>
                </Border>
                
                <!-- Bouton envoyer -->
                <Button Grid.Column="1"
                        x:Name="SendButton"
                        Text="âž¤"
                        FontSize="20"
                        WidthRequest="48"
                        HeightRequest="48"
                        CornerRadius="24"
                        BackgroundColor="{DynamicResource AccentColor}"
                        TextColor="White"
                        Margin="8,0,0,0"
                        Clicked="OnSendMessageClicked"
                        IsEnabled="False"/>
            </Grid>
        </Border>
    </Grid>
</ContentPage>
