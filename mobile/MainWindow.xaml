<?xml version="1.0" encoding="utf-8"?>
<Window xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
        xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
        xmlns:local="clr-namespace:mobile"
        x:Class="mobile.MainWindow">
    <!-- TitleBar .NET 9 personnalisée (Windows et Mac uniquement) -->
    <Window.TitleBar>
        <TitleBar Title="☁️ WeatherForecast"
                  Subtitle="Test"
                  Icon="appicon.png"
                  BackgroundColor="{DynamicResource TitleBarBackground}"
                  ForegroundColor="{DynamicResource TitleBarForeground}"
                  HeightRequest="48">
            <TitleBar.LeadingContent>
                <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                    <!-- Bouton Account (visible si connecté) -->
                    <Button x:Name="AccountButton"
                            Text="HA"
                            HeightRequest="30"
                            WidthRequest="30"
                            Padding="1,0,0,2.2"
                            FontSize="16"
                            FontFamily="SegoeSemibold"
                            Margin="0"
                            TextColor="{DynamicResource TitleBarForeground}"
                            Background="{DynamicResource AccountButtonBackground}"
                            BorderColor="{DynamicResource AccountButtonBorderColor}"
                            BorderWidth="1.2"
                            CornerRadius="20"
                            Clicked="OnAccountTapped"
                            IsVisible="False"
                            VerticalOptions="Center"
                            HorizontalOptions="Center" />

                    <!-- Bouton People (visible si non connecté) -->
                    <ImageButton x:Name="PeopleButton"
                                 HeightRequest="30"
                                 WidthRequest="30"
                                 Padding="0"
                                 Margin="5,0,0,0"
                                 BorderColor="{DynamicResource BorderColor}"
                                 BorderWidth="1.5"
                                 CornerRadius="20"
                                 Clicked="OnPeopleTapped"
                                 IsVisible="True"
                                 Background="{DynamicResource PeopleButtonBackground}">
                        <ImageButton.Source>
                            <FontImageSource Size="18"
                                             Glyph="&#xE716;"
                                             FontFamily="SegoeMDL2"
                                             Color="{DynamicResource TitleBarForeground}" />
                        </ImageButton.Source>
                    </ImageButton>
                </HorizontalStackLayout>
            </TitleBar.LeadingContent>
            <TitleBar.Content>
                <SearchBar x:Name="TitleSearchBar" Placeholder="Rechercher une ville..."
                           PlaceholderColor="{DynamicResource TitleBarSearchPlaceholder}"
                           TextColor="{DynamicResource TitleBarSearchText}"
                           MaximumWidthRequest="300"
                           BackgroundColor="{DynamicResource TitleBarSearchBackground}"
                           HorizontalOptions="Fill"
                           VerticalOptions="Center" />
            </TitleBar.Content>
            <TitleBar.TrailingContent>
                <HorizontalStackLayout Spacing="8"
                                       Padding="0,0,12,0">
                    <!-- Bouton Settings -->
                    <ImageButton x:Name="MessagesButton"
                                 HeightRequest="36"
                                 WidthRequest="36"
                                 BorderWidth="0"
                                 Clicked="OnMessagesTapped"
                                 Background="Transparent">
                        <ImageButton.Source>
                            <FontImageSource Size="18"
                                             Glyph="&#xE8BD;"
                                             FontFamily="SegoeMDL2"
                                             Color="{DynamicResource TitleBarForeground}" />
                        </ImageButton.Source>
                    </ImageButton>
                    <!-- Bouton Notifications avec badge -->
                    <Border Padding="0"
                            BackgroundColor="Transparent"
                            StrokeThickness="0">
                        <Grid HeightRequest="36" 
                              WidthRequest="36">
                            <ImageButton x:Name="NotificationsButton"
                                         HeightRequest="36"
                                         WidthRequest="36"
                                         BorderWidth="0"
                                         Clicked="NotificationsTapped"
                                         Background="Transparent">
                                <ImageButton.Source>
                                    <FontImageSource Size="18"
                                                     Glyph="&#xEDAC;"
                                                     FontFamily="SegoeMDL2"
                                                     Color="{DynamicResource TitleBarForeground}" />
                                </ImageButton.Source>
                            </ImageButton>
                            
                            <!-- Badge de compteur -->
                            <Border x:Name="NotificationBadge"
                                    WidthRequest="18"
                                    HeightRequest="18"
                                    BackgroundColor="#EF4444"
                                    StrokeShape="Ellipse"
                                    StrokeThickness="2"
                                    Stroke="{DynamicResource TitleBarBackground}"
                                    HorizontalOptions="End"
                                    VerticalOptions="Start"
                                    Margin="0,-3,-3,0"
                                    IsVisible="False">
                                <Label x:Name="NotificationBadgeText"
                                       Text="0"
                                       FontSize="10"
                                       FontAttributes="Bold"
                                       TextColor="White"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       Margin="0,0,0,1"/>
                            </Border>
                        </Grid>
                    </Border>
                    <!-- Bouton Settings -->
                    <ImageButton x:Name="SettingsButton"
                                 HeightRequest="36"
                                 WidthRequest="36"
                                 BorderWidth="0"
                                 Clicked="OnSettingsTapped"
                                 Background="Transparent">
                        <ImageButton.Source>
                            <FontImageSource Size="18"
                                             Glyph="&#xE713;"
                                             FontFamily="SegoeMDL2"
                                             Color="{DynamicResource TitleBarForeground}" />
                        </ImageButton.Source>
                    </ImageButton>
                </HorizontalStackLayout>
            </TitleBar.TrailingContent>
        </TitleBar>
    </Window.TitleBar>
</Window>